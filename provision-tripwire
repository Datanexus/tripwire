#!/usr/bin/env ansible-playbook
# (c) 2018 DataNexus Inc.  All Rights Reserved.
#
# main routine for provisioning tripwire
---
- name: TRIPWIRE OVERLAY | installing tripwire platform across platform nodes
  hosts: all:!controlcenter_broker:!all_brokers
  tags:
    - tripwire
  vars_files:
    - "{{ tenant_config_path }}/config/applications/tripwire.yml"
  gather_facts: yes
  tasks:
    - import_role:
        name: tripwire

- name: TRIPWIRE OVERLAY | checking file integrity
  hosts: all:!controlcenter_broker:!all_brokers
  tags:
    - check
  gather_facts: no
  tasks:
    - include_role:
        name: tripwire
        tasks_from: check

- name: TRIPWIRE OVERLAY | updating database
  hosts: all:!controlcenter_broker:!all_brokers
  tags:
    - update
  vars_files:
    - "{{ tenant_config_path }}/config/applications/tripwire.yml"
  gather_facts: yes
  tasks:
    - include_role:
        name: tripwire
        tasks_from: update

- name: TRIPWIRE OVERLAY | displaying latest report
  hosts: all:!controlcenter_broker:!all_brokers
  tags:
    - report
  vars_files:
    - "{{ tenant_config_path }}/config/applications/tripwire.yml"
  gather_facts: yes
  tasks:
    - include_role:
        name: tripwire
        tasks_from: report
